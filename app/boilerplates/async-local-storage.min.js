(function(a,b){"use strict";if(void 0!==a.window&&a.window===a&&void 0!==a.indexedDB){var c="async_local_storage",d="als_objects",e=1,f=null,g={};g.tail=new Promise(function(a){a.fulfill()}),g.add=function(a,b){var c=g.tail,d=function(){return q().then(function(){var c=new Promise(function(b){m(a,b)});return b===!0?c:new Promise(function(a){var b=a.fulfill.bind(a);setTimeout(function(){c.then(b,b)},1)})})};return g.tail=c.then(d,d)};var i,j,o,h=function(a){return a},k=function(){i=null,j=null},l=b.userAgent.match(/Firefox\/\d+(\.\d+)/)instanceof Array,m=function(a,b){var c=a.operation,e=a.transform||h;if(l&&i&&j)try{j.count()}catch(g){console.log("  store.count failed = ("),console.log("  clearTrans();"),k()}i||(i=f.transaction([d],"readwrite"),j=i.objectStore(d),i.onabort=i.onerror=i.oncomplete=k);var m=null,n=function(a){b.resolve(e(a))},o=function(a){b.reject(a)};switch(c){case"get":m=j.get(a.key);break;case"set":m=j.put(a.value,a.key);break;case"delete":m=j.delete(a.key);break;case"clear":m=j.clear();break;case"has":m=j.count(a.key);break;case"count":m=j.count();break;case"forEach":return m=j.openCursor(),m.onsuccess=function(b){var c=b.target.result;if(c){try{a.callback.call(a.scope||null,c.value,c.key)}catch(d){return o(d),void 0}c.continue()}else n()},m.onerror=o,void 0}return m?(m.onsuccess=function(){n(m.result)},m.onerror=o,void 0):(o(Error("IDB Request Failed")),void 0)},n=!1,p=new Promise(function(a){o=a}),q=function(){if(n)return p;n=!0;var b=a.indexedDB.open(c,e);return b.onupgradeneeded=function(a){f=a.target.result,f.createObjectStore(d)},b.onsuccess=function(a){f=a.target.result,o.resolve(a)},b.onfailure=o.reject.bind(o),p},r=function(a){return{configurable:!0,enumerable:!1,writable:!1,value:a}},s=b.alsPolyfillStorage=Object.create(null,{has:r(function(a){return g.add({operation:"has",key:a,transform:function(a){return!!a}})}),set:r(function(a,b){return g.add({operation:"set",key:a,value:b})}),get:r(function(a){return g.add({operation:"get",key:a})}),"delete":r(function(a){return g.add({operation:"delete",key:a})}),clear:r(function(){return g.add({operation:"clear"})}),count:r(function(){return g.add({operation:"count"})}),forEach:r(function(a,b){return g.add({operation:"forEach",callback:function(b,c){a(b,c,s)},scope:b},!0)})})}})(this,this.navigator||{});
